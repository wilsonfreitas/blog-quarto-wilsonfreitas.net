{
  "hash": "2049456aba295534b37f129abd1359ba",
  "result": {
    "markdown": "---\ntitle: \"Cálculo da taxa de juro real no Brasil\"\ndescription: |\n    As taxas de juros de mercado, a taxa DI e SELIC, são divulgadas em termos nominais.\n    Entretanto, a taxa de juros importante para a economia é a taxa de juro\n    real, que é a diferença entre a taxa de juro nominal praticada na economia\n    descontada pela inflação.\n    Como utilizar o R para calcular a série histórica da taxa de juro real\n    *realizada*.\nauthor:\n  - name: Wilson Freitas\n    url: {}\ndate: 2023-02-19\ncategories:\n  - R\n  - fixedincome\n  - bcb\n  - opendata\n---\n\n\nA análise de investimentos no Brasil gira muito em torno de produtos indexados\nàs taxas básicas de juros, Taxa DI e SELIC.\nEstas são taxas de juros nominais, ou seja, não consideram a inflação corrente.\nMuitas vezes a discussão sobre taxas nominais é míope, dado que a inflação corroe\na rentabilidade obtida.\n\nA taxa de juros importante para a economia é a taxa de juro real, que é a taxa\nde juros acima da inflação corrente.\nEsta sim deveria ser a medida de referência para avaliação de rentabilidade\nde investimentos.\n\nVamos ver aqui como calcular a taxa de juros real e para isso utilizaremos a\nTaxa DI (CDI) como taxa de juros nominal e o IPCA como índice de inflação.\nOs valores obtidos podem ser um pouco diferentes caso a taxa SELIC seja utilizada\ncomo taxa nominal.\nUma alternativa é utilizar outro índice de inflação, como o IGP-M, e neste\ncaso os resultados podem ser bem diferentes em alguns períodos.\nA escolha do índice de inflação deve refletir as premissas dos agentes.\nHá indivíduos mais sensíveis aos fatores refletidos pelo pelo IGP-M, como custo\nde aluguel, por exemplo.\nPara estes indivíduos faz mais sentido a alternativa pelo IGP-M.\nVamos seguir com o IPCA por ser o índice mais utilizado no mercado para se\navaliar a inflação.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rbcb)\nlibrary(bizdays)\nlibrary(tidyverse)\n```\n:::\n\n\n\nA função `rbcb::get_series` será utilizada para obter as séries de CDI e IPCA a partir\ndo serviço de séries temporais do Banco Central (BCB).\nÉ necessário conhecer os códigos das séries no SGS (Sistema de Gerenciador de Séries Temporais)\nmantido pelo BCB.\nIsso é meio mala, mas não tem jeito, é preciso conhecer os códigos numéricos ou\nfazer uma busca no site do SGS para obter os códigos.\nA série do IPCA é mensal, por este motivo vou utilizar a série mensal do CDI, pra\nfacilitar a conta mesmo, assim não é necessário calcular o IPCA diário.\n\n\n::: {.cell hash='index_cache/html/download-monthly-data_6a9855bf82f8ceb98e51b030be6dccf4'}\n\n```{.r .cell-code}\nseries_ <- get_series(\n  c(CDI = 4391, IPCA = 433),\n  start_date = \"2001-01-01\", end_date = \"2022-12-31\"\n)\n```\n:::\n\n\nAs séries baixadas estão em percentual, de forma que é necessário efetuar a divisão\npor 100 para ter as séries unidades decimais.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncdi <- series_$CDI |>\n  mutate(CDI = CDI / 100)\n\nipca <- series_$IPCA |>\n  mutate(IPCA = IPCA / 100)\n\nrates <- left_join(cdi, ipca, by = \"date\")\n\nrates |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  date          CDI   IPCA\n  <date>      <dbl>  <dbl>\n1 2001-01-01 0.0126 0.0057\n2 2001-02-01 0.0101 0.0046\n3 2001-03-01 0.0125 0.0038\n4 2001-04-01 0.0118 0.0058\n5 2001-05-01 0.0133 0.0041\n6 2001-06-01 0.0127 0.0052\n```\n:::\n:::\n\n\nDe posse da inflação mensal $i$ e da taxa de juros mensal $r$ é só descontar a taxa de\njuros pela inflação de acordo com a equação abaixo.\n\n$$\n1 + j = \\frac{1 + r}{1 + i}\n$$\n\nEssa equação resulta na taxa de juro real mensal $j$, dado que todas as taxas de\njuros na equação são mensais.\nEntretanto eu só entendo taxas de juros anualizadas, assim eu consigo\ncomparar com as demais taxas da economia, que são todas anuais.\nPara converter em taxa anual faz-se a seguinte conta.\n\n$$\nj_a = (1 + j)^{12} - 1\n$$\n\n$j_a$ é a taxa de juro real anualizada.\nBem, entendidas as equações, vamos aplicá-las.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates <- rates |>\n  mutate(\n    CDI_real = ((1 + CDI) / (1 + IPCA)) - 1,\n    CDI_real_annu = (1 + CDI_real) ^ 12 - 1,\n  )\n```\n:::\n\n\nCalculadas as taxas de juros reais é interessante visualizá-las para conhecer a\nsua dinâmica com o passar dos anos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates |>\n  ggplot(aes(x = date, y = CDI_real_annu)) +\n  geom_line() +\n  geom_area(fill = \"red\", alpha = 0.25) +\n  scale_y_continuous(labels = scales::percent) +\n  labs(\n    x = \"Data\", y = NULL,\n    title = \"Taxa de Juro Real Mensal\",\n    subtitle = \"Período de 2020 a 2022\",\n    caption = \"Desenvolvido por wilsonfreitas / Fonte: BCB\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nAté aqui realizamos o trabalho fácil, aplicar fórmulas para calcular a taxa de juro\nreal a partir da taxa de juro nominal e da inflação corrente.\nComo todas as taxas de juros utilizadas eram taxas mensais, não foi necessário\nrealizar conversões nas taxas.\nContudo, a vida não é tão simples assim, no mundo real as taxas de juros, Taxa DI e SELIC,\nsão divulgadas diariamente.\nComo a inflação é divulgada com frequência mensal é necessário transformar a inflação\nmensal em inflação diária.\nVamos realizar esses cálculos abaixo.\n\n\n::: {.cell hash='index_cache/html/download-daily-data_2a9fd39cc8258cc25e8638da4f8ca158'}\n\n```{.r .cell-code}\nseries_ <- get_series(\n  c(CDI = 12, IPCA = 433),\n  start_date = \"2001-01-01\", end_date = \"2022-12-31\"\n)\n```\n:::\n\n\nUtilizando o cógigo 12 para a Taxa DI, que retorna a Taxa DI ao dia, não é preciso\nconverter a taxa anual para taxa diária.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncdi <- series_$CDI |>\n  mutate(CDI = CDI / 100)\nipca <- series_$IPCA |>\n  mutate(\n    date = following(date, \"Brazil/ANBIMA\"),\n    IPCA = IPCA / 100\n  )\n```\n:::\n\n\nRealizamos um ajuste nas datas de inflação, como os dados são mensais, a data\nutilizada é o primeiro dia de cada mês, contudo, as taxas CDI são divulgadas em\ndias úteis e em diversos meses o dia 1 do mês não é um dia útil.\nA função `bizdays::following` faz exatamente o ajuste que precisamos, se a\ndata passada for um dia útil, segundo o calendário informado, a própria data\né retornada, caso contrário, o primeiro dia útil após essa data é retornado.\n\nCom as datas ajustadas podemos juntar os datasets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates <- left_join(cdi, ipca, by = \"date\")\n```\n:::\n\n\nPara calcular a inflação diária a partir da inflação mensal, vamos criar um índice\nque represente o mês corrente e *quebrar* o dataset em blocos com dados mensais e \nnestes blocos vamos realizar os cálculos para encontrar: a inflação diária,\na taxa de juro real e a taxa de juro real anual, pois agora estamos trabalhando\ncom dados diários e como já disse, só consigo avaliar taxas de juros anuais.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates <- rates |>\n  mutate(month = format(date, \"%Y-%m\"))\n\nrates <- split(rates, rates$month) |>\n  map_dfr(function(df) {\n    dt <- nrow(df)\n    df[\"IPCA_daily\"] <- (1 + df$IPCA[1]) ^ (1 / dt) - 1\n    df[\"CDI_real\"] <- (1 + df$CDI) / (1 + df$IPCA_daily) - 1\n    df[\"CDI_real_annu\"] <- (1 + df$CDI_real) ^ 252 - 1\n    df\n  })\n```\n:::\n\n\nApós calcular as taxas de juros, vou colocar em um gráfico para observar a sua dinâmica\nna série histórica.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates |>\n  ggplot(aes(x = date, y = CDI_real_annu)) +\n  geom_line() +\n  geom_area(fill = \"red\", alpha = 0.25) +\n  scale_y_continuous(labels = scales::percent) +\n  labs(\n    x = \"Data\", y = NULL,\n    title = \"Taxa de Juro Real Diária\",\n    subtitle = \"Período de 2020 a 2022\",\n    caption = \"Desenvolvido por wilsonfreitas / Fonte: BCB\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-daily-data-1.png){width=672}\n:::\n:::\n\n\nTendo ambas as séries, de juro real e nominal, é interessante observar o impacto\nda inflação para a rentabilidade no período.\n\nVamos começar a análise filtrando a partir de 2001.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates |>\n  filter(date >= as.Date(\"2001-01-01\")) |>\n  mutate(\n    CDI_acc = cumprod(1 + CDI) - 1,\n    CDI_real_acc = cumprod(1 + CDI_real) - 1,\n  ) |>\n  select(date, CDI_acc, CDI_real_acc) |>\n  tidyr::pivot_longer(c(CDI_acc, CDI_real_acc),\n    names_to = \"rates\"\n  ) |>\n  ggplot(aes(x = date, y = value, colour = rates)) +\n  geom_line(size = 1) +\n  scale_y_continuous(labels = scales::percent) +\n  labs(\n    x = \"Data\", y = NULL,\n    title = \"Rentabilidade - Juro Real x Juro Nominal\",\n    subtitle = \"Juros acumulados no período de 2001-2022\",\n    caption = \"Desenvolvido por wilsonfreitas / Fonte: BCB\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nEm 20 anos o efeito da inflação é devastador na rentabilidade no período.\nVou dar um zoom a partir de 2020, o ano da pandemia de COVID-19.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates |>\n  filter(date >= as.Date(\"2020-01-01\")) |>\n  mutate(\n    CDI_acc = cumprod(1 + CDI) - 1,\n    CDI_real_acc = cumprod(1 + CDI_real) - 1,\n  ) |>\n  select(date, CDI_acc, CDI_real_acc) |>\n  tidyr::pivot_longer(c(CDI_acc, CDI_real_acc),\n    names_to = \"rates\"\n  ) |>\n  ggplot(aes(x = date, y = value, colour = rates)) +\n  geom_line(size = 1) +\n  scale_y_continuous(labels = scales::percent) +\n  labs(\n    x = \"Data\", y = NULL,\n    title = \"Rentabilidade - Juro Real x Juro Nominal\",\n    subtitle = \"Juros acumulados no período de 2020-2022\",\n    caption = \"Desenvolvido por wilsonfreitas / Fonte: BCB\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nNeste intervalo tivemos juros reais negativos por um longo período, fica\nevidente o efeito dos juros negativos, um longo período de rentabilidade negativa.\n\nOutra coisa que me chama a atenção para dinâmica da taxa de juro real é o\ncomportamento da taxa acumulada no período de 1 ano.\nUma análise de janela móvel, onde a taxa diária é acumulada em períodos de 252\ndias.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates |>\n  mutate(\n    roll_CDI_real = c(\n      rep(NA, 251),\n      zoo::rollapply(CDI_real, 252, function(x) prod(1 + x) - 1)\n    ),\n  ) |>\n  ggplot(aes(x = date, y = roll_CDI_real)) +\n  geom_line(size = 1) +\n  scale_y_continuous(labels = scales::percent) +\n  labs(\n    x = \"Data\", y = NULL,\n    title = \"Taxa de Juro Real acumulada em 252 dias úteis\",\n    subtitle = \"Período de 2001 a 2022\",\n    caption = \"Desenvolvido por wilsonfreitas / Fonte: BCB\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-rolling-daily-data-1.png){width=672}\n:::\n:::\n\n\nInteressante observar como o efeito da janela móvel suaviza a curva.\nNo período de 2001 a 2010 tivemos taxas bem elevadas, que começaram uma\ntrajetória de queda que durou até 2016, quando a coisa toda zoou de vez.\nApós 2020 foi só desgraça.\nCurioso observar que não tem período tranquilo, a taxa sobe rápido e também cai rápido,\nimportante ressaltar que essa é a taxa acumulada em 12 meses, talvez fosse interessante\ne\ns\nperar um comportamente mais estável para esse número.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "74c98616f3d96c839d34a7115e8522d7",
  "result": {
    "markdown": "---\ntitle: \"20 anos de retornos de ações no Brasil\"\ndescription: |\n    No Brasil é muito difícil fazer análises de investimentos em ações para períodos muito longos.\n    Não há um histórico longo, como 50 anos de dados, para realizarmos uma análise de longo prazo.\n    Apresento aqui uma análise para 20 anos, no período entre 2000 e 2019 completos.\n    A análise traz retornos em dólar, nominais, reais e prêmio de risco, para investimentos em juros,\n    e alguns índices de mercado.\nauthor:\n  - name: Wilson Freitas\n    url: {}\ndate: 2023-11-25\ncategories:\n  - R\n  - rb3\n  - bcb\n  - opendata\nformat: \n  html:\n    fig-width: 10\n    fig-height: 3\n---\n\n\nGosto de olhar com frequência o retorno real, retorno acima da inflação, para alguns tipos de investimento, e\ntambém o excesso de retorno, retorno acima da taxa de juros livre de risco.\nGosto de fazer estas variáveis pois são métricas simples onde todo bom investimento deveria apresentar resultados\npositivos no longo prazo.\nAdicionalmente também gosto de olhar retornos em dólar pois acho uma boa *proxy* para avaliação de preservação de valor\nou poder de compra.\n\nPrimeiramente importando os pacotes utilizados.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rbcb)\nlibrary(rb3)\n```\n:::\n\n\nVamos começar obtendo os dados da taxa livre de risco, a taxa DI, da taxa de variação da inflação (IPCA) e do dólar.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-2_477f7f139c56a8eb6028922a79e65bb0'}\n\n```{.r .cell-code}\ncdi <- get_series(c(CDI = 4389), start_date = as.Date(\"2000-01-01\"))\nipca <- get_series(c(IPCA = 433), start_date = as.Date(\"2000-01-01\"))\nbrlusd <- get_series(c(BRLUSD = 1), start_date = as.Date(\"2000-01-01\"))\n```\n:::\n\n\nAgora vou transformar a série de variação da inflação, que é uma série mensal, em uma série diária.\nQuero fazer a análise com dados diários, todas as variáveis da análise são divulgadas em dados diários.\nPara fazer este ajuste, vou calcular a taxa de inflação diária convertendo a taxa mensal em uma taxa diária,\nconsiderando um regime taxas de juros compostos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates <- left_join(\n  cdi |> mutate(month = format(date, \"%Y-%m\")),\n  ipca |> mutate(month = format(date, \"%Y-%m\")) |> select(month, IPCA),\n  by = \"month\"\n)\n\nipca <- split(rates, rates$month) |>\n  map_dfr(function(df) {\n    dt <- nrow(df)\n    df[\"IPCA\"] <- ((1 + df$IPCA[1] / 100) ^ (1 / dt) - 1) * 100\n    df\n  }) |>\n  select(-month, -CDI) |>\n  filter(!is.na(IPCA))\n```\n:::\n\n\n\nUma vez que temos:\n\n- taxa de inflação diária;\n- taxa DI diária (juros nominal);\n- dólar diário (taxa de câmbio).\n\nVou calcular os retornos, real e em dólar.\nAntes faço a conversão das taxas de juros para taxas contínuas.\nIsso simplifica a manipulação das taxas de juros evitando o malabarismo nas contas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates <- cdi |>\n  left_join(ipca, join_by(date)) |>\n  left_join(brlusd, join_by(date)) |>\n  mutate(\n    log_cdi = log((1 + CDI / 100)^(1 / 252)),\n    log_ipca = log(1 + IPCA / 100),\n    log_price_brlusd = log(BRLUSD),\n    log_ret_brlusd = c(0, diff(log_price_brlusd)),\n    real_cdi = log_cdi - log_ipca,\n    usd_cdi = log_cdi - log_ret_brlusd,\n  ) |>\n  filter(date >= as.Date(\"2000-01-01\"), date < as.Date(\"2020-01-01\"))\n```\n:::\n\n\nA *dolarização* dos retornos diários em taxa DI são calculados da mesma forma que o retorno real, subtraindo o\nretorno do índice da taxa DI diária.\nConsiderando que $U_t$ é um montante em USD e $N_t$ um montante equivalente em BRL convertido a uma taxa de câmbio\n$c_t$ de reais por dólar (BRL/USD), tudo isso no instante $t$.\nAssim, temos em $t$\n\n$$\nN_t^{\\langle BRL \\rangle} = U_t^{\\langle USD \\rangle} \\cdot c_t^{\\langle BRL/USD \\rangle}\n$$\n\nNo instante $T$ temos o montante $N_{T}$ em BRL capitalizado pela taxa DI.\nFaz-se a conversão a taxa de câmbio $c_T$ para se obter o montante em dólar $U_T$.\nO retorno de $U$ é dado por\n\n$$\n\\log \\frac{U_T}{U_t} = \\log \\frac{N_T}{N_t} - \\log \\frac{c_T}{c_t}\n$$\n\nonde $\\log \\frac{N_T}{N_t}$ é o retorno da taxa DI no período e $\\log \\frac{c_T}{c_t}$ o retorno da taxa de câmbio no\nperíodo, logo, o retorno em USD de um investimento em taxa DI.\nIsso é calculado aqui em base diária apenas para fins de comparação e como um exercício analítico,\nna prática, a conversão diária de um investimento em dólar não se aplica.\nTalvez para fins de acompanhamento faça algum sentido.\n\nAbaixo temos o código que gera o gráfico de taxas de retorno acumulados.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates |>\n  select(date, real_cdi, log_cdi, usd_cdi) |>\n  mutate(\n    Nominal = exp(cumsum(log_cdi)) - 1,\n    Real = exp(cumsum(real_cdi)) - 1,\n    USD = exp(cumsum(usd_cdi)) - 1,\n  ) |>\n  tidyr::pivot_longer(c(Real, Nominal, USD), names_to = \"Taxas\") |>\n  ggplot(aes(x = date, y = value, colour = Taxas)) +\n  geom_line(linewidth = 1) +\n  scale_y_continuous(labels = scales::percent) +\n  labs(\n    x = \"Data\", y = NULL,\n    title = \"Rentabilidade de investimento em CDI no período de 2000-2019\",\n    subtitle = \"Retorno total, real e em dólar\",\n    caption = \"Desenvolvido por wilsonfreitas / Fonte: BCB\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\nNo gráfico vemos a insensatez que é falar em retorno total para longo prazo sem considerar a inflação.\nPensando em poder de compra, temos que no período de 20 anos o investimento em taxa DI foi de 250%, preservando o poder de compra e sobrando um pouquinho pra aumento de gastos.\nDe acordo com estes resultados, se a dua despesa aumentou em mais de 250% nestes 20 anos, você terá um problema de liquidez.\nA *dolarização* apresenta um resultado um pouco melhor, mostrando que tirar o dinheiro do Brasil é uma boa \nideia para a preservação de poder de compra.\n\nSeguindo com a análise, vamos um exercício equivalente para os índices de mercado: IBOVESPA e IBrX-100.\nVamos obter os dados dos índices.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-6_07550cc24e5e8c53eddb63e4f99817c0'}\n\n```{.r .cell-code}\nibov <- index_get(\"IBOV\", as.Date(\"2000-01-01\"), do_cache = FALSE) |>\n  arrange(refdate)\nibxx <- index_get(\"IBXX\", as.Date(\"2000-01-01\"), do_cache = FALSE) |>\n  arrange(refdate)\n```\n:::\n\n\nOs índices IBOVESPA e IBrX-100 possuem histórico anterior à 2000, contudo, como quero analisar o período de\n20 anos entre 2000 e 2019, vou limitar o tamanho do histórico.\nPara os índices vamos calcular:\n\n- prêmio de risco (excesso de retorno)\n- retorno real\n- retorno em dólar\n- retorno total\n\nA função abaixo, `calc_rates`, realiza todos estes cálculos e retorna um dataframe com os dados prontos para o\ngráfico.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalc_rets <- function(df) {\n  df |>\n    left_join(cdi, join_by(refdate == date)) |>\n    left_join(ipca, join_by(refdate == date)) |>\n    left_join(brlusd, join_by(refdate == date)) |>\n    mutate(\n      log_cdi = log((1 + CDI / 100)^(1 / 252)),\n      log_ipca = log(1 + IPCA / 100),\n      log_price = log(value),\n      total_return = c(0, diff(log_price)),\n      log_price_brlusd = log(BRLUSD),\n      log_ret_brlusd = c(0, diff(log_price_brlusd)),\n      excess_return = total_return - log_cdi,\n      usd_return = total_return - log_ret_brlusd,\n      real_return = total_return - log_ipca,\n    ) |>\n    filter(refdate >= as.Date(\"2000-01-01\"), refdate < as.Date(\"2020-01-01\"))\n}\n```\n:::\n\n\nSegue também algumas funções que uso para a construção de gráficos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_returns <- function(df, index_name) {\n  period <- year(df$refdate) |>\n    range() |>\n    paste(collapse = \"-\")\n  df |>\n    mutate(\n      Real = exp(cumsum(real_return)) - 1,\n      USD = exp(cumsum(usd_return)) - 1,\n    ) |>\n    select(refdate, Real, USD) |>\n    tidyr::pivot_longer(c(Real, USD), names_to = \"Retornos\") |>\n    ggplot(aes(x = refdate, y = value, colour = Retornos)) +\n    geom_line(linewidth = 0.5) +\n    scale_y_continuous(labels = scales::percent) +\n    labs(\n      x = \"Data\", y = NULL,\n      title = glue::glue(\n        \"Retornos do {index_name}: em dólar e real, no período de {period}\"\n      ),\n      caption = \"Desenvolvido por wilsonfreitas / Fonte: B3\"\n    )\n}\n\nplot_excess_return <- function(df, index_name) {\n  period <- year(df$refdate) |>\n    range() |>\n    paste(collapse = \"-\")\n  df |>\n    ggplot(aes(x = refdate, y = exp(cumsum(excess_return)) - 1)) +\n    geom_line(linewidth = 0.5) +\n    scale_y_continuous(labels = scales::percent) +\n    labs(\n      x = \"Data\", y = NULL,\n      title = glue::glue(\n        \"Prêmio de risco acumulado do {index_name} no período de {period}\"\n      ),\n      caption = \"Desenvolvido por wilsonfreitas / Fonte: B3\"\n    )\n}\n```\n:::\n\n\nVamos começar com a análise de retornos: em dólar e real.\nPara isso vou apresentar um gráfico, para cada índice, onde temos o retorno real e o retorno em dólar.\nO objetivo dessa análise é verificar se os retornos acumulados no período são positivos.\nO que deve interessar a todo o investidor no longo prazo é retorno real significativo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nibov_calc <- calc_rets(ibov)\nplot_returns(ibov_calc, \"IBOVESPA\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\nVemos que o IBOVESPA apresenta um retorno real positivo de aproximadamente 100% no período de 20 anos.\nEm taxa anualizada isso é equivalente a 3.5% ao ano, algo equivalente a um título IPCA + 3.5%.\nNão é ruim, mas também não é uma maravilha.\n\nVamos para o IBrX-100.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nibxx_calc <- calc_rets(ibxx)\nplot_returns(ibxx_calc, \"IBrX-100\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\nO IBrX-100 apresenta um retorno real superior ao IBOVESPA no período de 20 anos.\nCom um retorno real de puco mais de 300% em 20 anos, o IBrX-100 entrega uma taxa anual de 7.2%.\nBem melhor que o IBOVESPA, o que reflete as deficiências do IBOVESPA.\n\nAgora vamos à análise de prêmio de risco (*equity risk premium*).\nOs gráficos a seguir mostram que o IBOVESPA não tem prêmio de risco positivo e que o IBrX-100 tem.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-2.png){width=960}\n:::\n:::\n\n\nUma análise complementar é valiar, para o período de análise, qual o percentual do período que os índices\napresentam um prêmio de risco positivo.\nIsso ajuda a identificar se esse prêmio de risco positivo é um comportamento do índice ou se é apenas um efeito\nda janela analisada.\nPara realizar isso pego o retorno acumulado e conto a quantidade de dias positivos e divido pelo total\nde dias.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nc(\n  IBOVESPA = sum((exp(cumsum(ibov_calc$excess_return)) - 1) > 0) / nrow(ibov_calc),\n  `IBrX-100` = sum((exp(cumsum(ibxx_calc$excess_return)) - 1) > 0) / nrow(ibxx_calc)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  IBOVESPA   IBrX-100 \n0.04283694 0.55910285 \n```\n:::\n:::\n\n\nComo podemos observar a diferença é brutal.\nParece que o IBOVESPA foi criado para ficar abaixo do CDI.\nNo período de 20 anos, em apenas 4% dos dias, o IBOVESPA apresentou um prêmio de risco positivo.\nEntretanto, o IBrX-100 apresentou prêmio de risco maior que zero em 55% dos dias no período de 20 anos.\n\nEm termos práticos, para fins de alocação, o ETF PIBB11 segue o índice IBrX-100 e possui bastante liquidez.\nEste ETF é uma ótima opção na composição das carteiras para representar um índice de mercado.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
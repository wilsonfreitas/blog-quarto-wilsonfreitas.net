{"title":"Curva de Juros de Americana - US Treasuries Curve","markdown":{"yaml":{"title":"Curva de Juros de Americana - US Treasuries Curve","description":"Como construir a curva de juros americana utilizando dados do Tesouro\nAmericano (US Treasury) e o pacote {fixedincome}.\n","author":[{"name":"Wilson Freitas","url":{}}],"date":"2022-06-06","categories":["R","fixedincome","opendata"]},"containsRefs":false,"markdown":"\n\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\nA curva de juros americana é uma peça fundamental do quebra-cabeças\neconômico/financeiro.\nNeste post vamos ver como obter os dados do histórico da estrutura a termo\nde juros dos Estados Unidos e como construir uma curva de juros utilizando\no pacote {fixedincome}.\n\nVamos utilizar o Quandl, que hoje é o\n[Nasdaq Data Link](https://data.nasdaq.com/), para obter o histórico de\njuros americanos.\n\n```{r get-data-fake, eval=FALSE}\nlibrary(Quandl)\n\nyc_all <- Quandl(\"USTREASURY/YIELD\")\n```\n\n```{r get-data, cache=TRUE, echo=FALSE}\nlibrary(Quandl)\nyc_all <- Quandl(\"USTREASURY/YIELD\", api_key = \"nJ1NhTYdEs2p3MsS4CVd\")\n```\n\n`yc_all` traz todo o histórico de juros, as *Constant Maturity Treasury rates*,\nque relacionam as taxas de juros ao um conjuto de prazos padronizados: 1, 3, e 6\nmeses, e 1, 2, 3, 5, 7, 10, 20, e 30 anos.\n\n```{r}\nhead(yc_all)\n```\n\nVamos montar a curva de juros para uma data específica utilizando os prazos\ndefinidos no histórico.\n\n```{r}\nlibrary(tidyverse)\n\nrefdate <- as.Date(\"2022-02-04\")\nyc <- yc_all |> filter(Date == refdate)\n\nyc\n```\n\nComecemos construindo o vetor de prazos da curva.\nPara isso precisamos interpretar os nomes das colunas e convertê-los em prazos.\n\n```{r}\nnx <- names(yc)\nterms_names <- nx[-1]\nterms_names\n```\n\nTemos `MO` indicando prazos em meses e `YR` indicando os anos.\nVamos utilizar uma simples substituição de texto para converter `MO`\npara `months` e `YR` para `years`.\nDessa forma podemos utilizar a função `fixedincome::as.term` que\nconverte um string em um objeto `term` (prazo).\n\n```{r}\nlibrary(stringr)\n\nterms_names <- terms_names |>\n  str_replace(\"MO\", \"months\") |>\n  str_replace(\"YR\", \"years\")\n\nterms_names\n```\n\nApós a conversão usamos a função `purrr::map` com a função\n`fixedincome::as.term` e assim vamos obter uma lista com diversos objetos\n`term`.\n\n```{r}\nlibrary(purrr)\nlibrary(fixedincome)\n\ncurve_terms <- map(terms_names, as.term)\ncurve_terms\n```\n\nObviamente tudo isso poderia ter sido feito de forma direta.\n\n```{r}\ncurve_terms <- nx[-1] |>\n  str_replace(\"MO\", \"months\") |>\n  str_replace(\"YR\", \"years\") |>\n  map(as.term)\n```\n\nPois bem, temos uma lista com prazos em meses e prazos em anos.\nÉ necessário converter os prazos para uma mesma unidade (`units`).\nVou converter todos os prazos para dias.\nPara fazer isso vou criar um objeto `daycount(\"actual/360\")`, que é a regra\nde contagem de dias que considera dias corridos e anos com 360 dias.\nCom a regra de contagem de dias conseguimos fazer a conversão dos prazos para\nanos e utilizando a quantidade de dias no ano da regra, 360, fazemos a\nconversão para dias.\n\n```{r}\ndc <- daycount(\"actual/360\")\n\nterms <- curve_terms |>\n  map_dbl(\\(x) dib(dc) * toyears(dc, x)) |>\n  term(\"days\")\n\nterms\n```\n\nA função `fixedincome::toyears` converte os prazos para um número em anos, por\nexemplo, 6 meses retorna 0.5, e a função `dib` retorna a quantidade de dias no\nano para a regra, neste caso, 360.\nConcluímos criando os objetos de prazo com `term`.\n\nAgora que já temos os prazos da curva vamos extrair as taxas do data.frame.\nÉ uma operação simples de extração de linhas de um data.frame e converter em\num vetor.\nFazemos uma verificação de `NA` por que eventualmente há podemos ter valores\nausentes para alguns prazos.\n\n```{r}\nrates <- yc[1, -1] |>\n  as.list() |>\n  as.numeric()\nrates <- rates / 100\nix <- !is.na(rates)\n\nrates[ix]\n```\n\nTendo os prazos, as taxas e a data de referência, podemos construir a curva\ncom a função `fixedincome::spotratecurve`.\nPara a curva de juros americana utilizamos taxa de juros simples\n(*compounding* `simple`), regra de contagem de dias (`actual/360`) e\no calendário de dias corridos (`actual`).\n\n```{r}\ntr_curve <- spotratecurve(\n  rates[ix], terms[ix],\n  \"simple\", \"actual/360\", \"actual\",\n  refdate = refdate\n)\n\ntr_curve\n```\n\nNote os prazos em dias.\nAgora é só visualizar a curva de forma graciosa!\n\n```{r}\nplot(tr_curve)\n```\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"curva-de-juros-de-americana-us-treasuries-curve.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.335","theme":"litera","title-block-banner":true,"title":"Curva de Juros de Americana - US Treasuries Curve","description":"Como construir a curva de juros americana utilizando dados do Tesouro\nAmericano (US Treasury) e o pacote {fixedincome}.\n","author":[{"name":"Wilson Freitas","url":{}}],"date":"2022-06-06","categories":["R","fixedincome","opendata"]},"extensions":{"book":{"multiFile":true}}}}}
{"title":"Expectativas de Mercado da Pesquisa Focus no R","markdown":{"yaml":{"title":"Expectativas de Mercado da Pesquisa Focus no R","description":"Obtendo as expectativas de mercado para os indicadores macroeconômicos da\nPesquisa Focus utilizando o R e o pacote {rbcb}.\n","author":"Wilson Freitas","date":"2022-06-03","categories":["R","bcb","opendata"],"format":{"html":{"toc":true,"html-math-method":"katex"}}},"headingText":"| label: setup","containsRefs":false,"markdown":"\n\n\n```{r}\n#| include: false\nknitr::opts_chunk$set(echo = TRUE)\n```\n\nÉ possível obter as expectativas de mercado para diversos indicadores\nmacroeconômicos da pesquisa Focus de forma totalmente automática utilizando\no R.\n\nVamos utilizar o pacote {rbcb} para obter estes dados.\nO pacote {rbcb} é uma interface para algumas das diversas APIs do portal de dados\nabertos do Banco Central ([link](https://dadosabertos.bcb.gov.br)).\n\n[expectativas-mercado]: https://dadosabertos.bcb.gov.br/dataset/expectativas-mercado\n\nAs expectativas de mercado para os indicadores macroeconômicos da pesquisa\nFocus são consolidadas em estatísticas diárias e divulgadas na\n[API][expectativas-mercado].\nEstas estatísticas são calculadas com base nas expectativas de mercado\nde diversos bancos, gestores de recursos e demais instituições do mercado\nfinanceiro.\nOs indicadores macroeconômicos são referentes a índices de preços, crescimento\ndo PIB e da produção industrial, taxa de câmbio, taxa Selic, variáveis fiscais\ne indicadores do setor externo e são publicadas todo primeiro dia útil da\nsemana.\n\nCarregando os pacotes utilizados.\n\n```{r}\n#| message: false\n#| warning: false\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(rbcb)\n```\n\n# Função `get_market_expectations`\n\nA função `get_market_expectations` implementa a interface para a API de\nexpectativas de mercado da pesquisa Focus.\nVejamos os seus argumentos e o que podemos fazer com eles:\n\n```{r}\nget_market_expectations |> args()\n```\n\n* `type`: A API de expectativas possui diversos *endpoints* e o argumento `type`\ndefine qual deve ser utilizado. Se não for informado o valor `annual` será utilizado.\n    * `annual`, `quarterly` e `monthly` retorna, respectivamente, as expectativas anuais, trimestrais e mensais dos indicadores macroeconômicos\n    * `inflation-12-months` para expectativas de inflação nos próximos 12 meses\n    * `top5s-monthly` e `top5s-annual` retorna as expectativas mensais e anuais para os indicadores do Top 5\n    * `institutions` expectativas informadas pelas instituições credenciadas\n    * `selic` expectativas de mercado SELIC\n    * `top5s-selic` expectativas Top 5 para SELIC\n* `indic` nome do indicador macroeconômico, é opcional, de forma, quando não\nfor definido, todos os indicadores disponíveis para o *endpoint* serão\nretornados. Esse ponto é curioso, pois a documentação não é boa e informa\nindicadores que não são mais disponibilizados.\n* `start_date` e `end_date` definem as datas de início e fim para a consulta,\nsão opcionais e caso não sejam informados, todo o período será retornado, o\nque não é recomendado pois onera os serviços de dados do BCB que já não são\nlá os melhores.\n* `keep_names` é um argumento utilizado internamente que não faz diferença para\no usuário final.\n* `...` aqui são passados argumentos adicionais para a API\n    * `$select` define as colunas retornadas na consulta: `Nome, Idade`\n    * `$filter` define filtros mais elaborados baseado nos valores das colunas: `Nome eq 'João'`\n    * `$orderby` define como as colunas devem ser ordenadas: `Nome asc, Idade desc`\n    * `$skip` define quantidade de linhas no começo que não devem ser retornadas\n    * `$top` define a quantidade de linhas que serão retornadas\n\n# Conhecendo os valores retornados\n\nCada *endpoint* possui o seu conjuto de colunas retornadas e isso pode mudar\ncom o tempo, dessa maneira, para conhecer cada API, eu recomendo fortemente\nque a opção `$top = 10` seja utilizada para limitar uma consulta inicial para\nconhecimento dos valores retornados.\n\n```{r}\n#| label: get_market_expectations-annual-IPCA-top-10\n#| cache: true\nget_market_expectations(\"annual\",\n  indic = \"IPCA\",\n  `$top` = 10\n) |>\n  rmarkdown::paged_table()\n```\n\nComo vemos, tem muito `NA`.\nTalvez seja por que estamos visualizando dados muito antigos, vamos reordenar\npara trazer os dados mais recentes.\nPara isso é necessário definir a opção `$orderby`.\n\n```{r}\n#| label: get_market_expectations-annual-IPCA-top-10-ordered\n#| cache: true\nget_market_expectations(\"annual\",\n  indic = \"IPCA\",\n  `$top` = 10,\n  `$orderby` = \"Data desc\"\n) |>\n  rmarkdown::paged_table()\n```\n\nJá ficou melhor, já é possível entender as informações retornadas.\n\n# Realizando uma consulta mais elaborada\n\nPodemos definir melhor a consulta e o que queremos dela:\n\n* retornar as colunas: Data, DataReferencia, Media, Mediana, Maximo, Minimo e DesvioPadrao.\nPara isso vamos utilizar a opção `$select`.\n* filtrar `baseCalculo` igual a 0 e `DataReferencia` igual a 2021 ou 2022 com a opção `$filter`.\n* Com data inicial igual a 2020-12-01, para pegar os dados desde dezembro de 2020\n\n```{r}\n#| label: get_market_expectations-annual-IPCA\n#| cache: true\ndf <- get_market_expectations(\"annual\",\n  indic = \"IPCA\",\n  start_date = \"2020-12-01\",\n  `$filter` = \"(DataReferencia eq '2021' or DataReferencia eq '2022') and baseCalculo eq 0\",\n  `$select` = \"Data,DataReferencia,Media,Mediana,DesvioPadrao,Maximo,Minimo\"\n)\ndf |>\n  head() |>\n  rmarkdown::paged_table()\n```\n\n# Visualizando os dados\n\nCom as estatísticas de expectativas de IPCA carregadas podemos começar a\nvisualização dos dados.\nEstas expectativas são referentes a inflação cheia para os anos de 2021 e 2022\n(DataReferencia).\nO filtro baseCalculo igual a 1 refere-se ao prazo de validade das expectativas\ninformadas.\nEsta coluna pode ser 0 ou 1.\nbaseCalculo igual a 0 considera as expectativas informadas nos últimos 30 dias\nno cálculo das estatísticas e baseCalculo igual a 1 considera os últimos 4 dias.\nFoi escolhida baseCalculo igual a 0 por ter uma amostra maior, consequência do\nperíodo maior.\n\n## Série temporal das expectativas de IPCA\n\nVamos começar observando a série temporal das expectativas para cada\nDataReferencia.\n\n```{r}\n#| label: ipca-mediana-datareferencia\ndf |>\n  ggplot(aes(x = Data, y = Mediana, group = DataReferencia, colour = DataReferencia)) +\n  geom_line() +\n  labs(\n    title = \"Expectativas para IPCA em 2021 e 2022\",\n    subtitle = \"Média das expectativas de IPCA\",\n    caption = \"Dados da Pesquisa Focus obtidos com pacote rbcb\",\n    x = \"Data\", y = \"Inflação\"\n  )\n```\n\nCurioso ver como as expectativas de inflação para 2021 mudaram ao longo de 2021,\nou seja, erra-se miseravelmente.\nAs expectativas para 2022 mudam menos, bem, isso até virar o ano.\n\n## Série temporal com intervalo informado\n\nVamos olhar agora apenas a DataReferencia 2021 e colocar as linhas de máximo e\nmínimo para termos uma ideia de intervalo para as expectativas.\n\n\n```{r}\n#| label: ipca-mediana-desviopadrao\ndf |>\n  filter(DataReferencia == 2021) |>\n  ggplot(aes(x = Data)) +\n  geom_line(aes(y = Mediana), colour = \"black\") +\n  geom_line(aes(y = Maximo), colour = \"grey\") +\n  geom_line(aes(y = Minimo), colour = \"grey\") +\n  geom_ribbon(aes(ymin = Minimo, ymax = Maximo), fill = \"blue\", alpha = 0.3) +\n  labs(\n    title = \"Expectativas para IPCA em 2021\",\n    subtitle = \"Média das expectativas de IPCA com intervalo definido por máximo e mínimo da amostra\",\n    caption = \"Dados da Pesquisa Focus obtidos com pacote rbcb\",\n    x = \"Data\", y = \"Inflação\"\n  )\n```\n\nInteressante ver como as pesquisas erram e como, mesmo os mais ousados, não\nsaem muito do consenso.\nEntendo que esse é um mecanismo necessário para se colocar o \"bode na sala\",\ne\nntretanto, erra-se miseravelmente, são muitos vieses envolvidos."},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"html-math-method":"katex","output-file":"expectativas-focus-com-rbcb.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.335","theme":"litera","title-block-banner":true,"title":"Expectativas de Mercado da Pesquisa Focus no R","description":"Obtendo as expectativas de mercado para os indicadores macroeconômicos da\nPesquisa Focus utilizando o R e o pacote {rbcb}.\n","author":"Wilson Freitas","date":"2022-06-03","categories":["R","bcb","opendata"]},"extensions":{"book":{"multiFile":true}}}}}
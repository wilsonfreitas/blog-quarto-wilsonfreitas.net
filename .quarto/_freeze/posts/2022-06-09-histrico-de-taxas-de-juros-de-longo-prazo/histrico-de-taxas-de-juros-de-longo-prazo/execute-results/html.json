{
  "hash": "58bd4c1970aef17ca2639e90ae960a1f",
  "result": {
    "markdown": "---\ntitle: \"Histórico de Taxas de Juros de Longo Prazo\"\ndescription: |\n  As taxas de juros de longo prazo são importantes variáveis econômicas.\n  Observar a dinâmica dessas taxas é fundamental para uma boa compreensão\n  do cenário econômico.\n  Vamos ver como utilizar o pacote {fixedincome} para construir o histórico da\n  taxa de juros prefixada para o prazo de 10 anos com dados extraídos da B3\n  com o pacote {rb3}.\nauthor:\n  - name: Wilson Freitas\n    url: {}\ndate: 2022-06-09\ncategories:\n  - R\n  - fixedincome\n  - rb3\n  - opendata\n---\n\n\n\n\nNo mercado norte americano há cotações para taxas de juros em prazos fixos,\n1 ano, 5 anos, 10 anos, e assim por diante.\nEstas estruturas são conhecidas como *Constant Term Maturities*.\n\nEstes dados podem ser obtidos do site do Tesouro Americano (US Treasury) com\no pacote {Quandl}.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(Quandl)\n\nyc_all <- Quandl(\"USTREASURY/YIELD\")\n```\n:::\n\n::: {.cell hash='histrico-de-taxas-de-juros-de-longo-prazo_cache/html/quandl-data-load_92ec0f19cb17d539d0e04a4dcb7ddb66'}\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: xts\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: zoo\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n:::\n\n\nPodemos observar um longo histórico, desde a década de 90, para estas taxas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nyc_all |>\n    ggplot(aes(x = Date, y = `10 YR` / 100)) +\n    geom_line() +\n    labs(\n        x = NULL, y = NULL,\n        title = \"Histórico de Taxas de Juros Americanos de 10 Anos (Treasury Bonds)\",\n        caption = \"Dados do US Treasury obtidos com o pacote Quandl - wilsonfreitas\"\n    ) +\n    scale_y_continuous(labels = scales::percent)\n```\n\n::: {.cell-output-display}\n![](histrico-de-taxas-de-juros-de-longo-prazo_files/figure-html/show-curve-1.png){width=672}\n:::\n:::\n\n\nNo mercado brasileiro, infelizmente, a vida é um pouco miserável,\ne não há um histórico disponível com taxas de longo prazo.\nÉ necessário construir na unha e na força do ódio.\n\nOs ativos líquidos de onde são extraídas as taxas de\njuros de longo prazo são os contratos futuros de taxa DI - DI1, que são cotados\ndiariamente na B3 em seus vencimentos.\nEntretanto, as taxas de juros obtidas destes contratos apresentam um prazo\ndiferente a cada dia.\nAssim, é necessário construir uma curva de juros com estes contratos e\nrealizar uma interpolação nos prazos fixos, 1 ano, 5 anos, 10 anos, e por aí vai.\n\nVamos utilizar o pacote {rb3} para obter o histórico com as curvas diárias\nde juros prefixados do mercado brasileiro e o pacote {fixedincome}\npara construir os objetos de curvas de juros e realizar a interpolação\ndas curvas nos vértices fixos para obter o histórico de taxas de juros\nde longo prazo.\n\nVamos começar importando os pacotes utilizados nessa jornada.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rb3)\nlibrary(bizdays)\nlibrary(fixedincome)\nlibrary(tidyverse)\n```\n:::\n\n\nA função `rb3::yc_mget` retorna um data.frame com o histórico de curvas de juros.\nVamos baixar um histórico desde 2019.\n\n\n::: {.cell hash='histrico-de-taxas-de-juros-de-longo-prazo_cache/html/rb3-data-load_0fdcc5ef640d402b17c6d5681aa7b472'}\n\n```{.r .cell-code}\ndc <- yc_mget(\n    first_date = \"2019-01-01\",\n    last_date = preceding(Sys.Date() - 1, \"Brazil/ANBIMA\"),\n    cache_folder = \"../../../rb3-data\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Automatic coercion from double to character was deprecated in purrr 1.0.0.\nℹ Please use an explicit call to `as.character()` within `map_chr()` instead.\nℹ The deprecated feature was likely used in the rb3 package.\n  Please report the issue at <https://github.com/wilsonfreitas/rb3/issues>.\n```\n:::\n:::\n\n\nDe posse do histórico, vamos construir as curvas de juros para cada data de referência\nutilizando a função `fixedincome::spotratecurve`.\nA curva de juros prefixada tem as seguintes características:\n\n- regime de capitalização: `discrete` (juros compostos)\n- regra de contagem de dias: `business/252`\n- calendário: `Brazil/ANBIMA`\n- interpolação: flat-forward\n\nAdicionalmente faço uma limpeza nos eventuais problemas encontrados nos dados, como\ndias úteis zerados e duplicados.\nBem, é de graça, exigir dados corretos deve ser um pouco demais, né?\n\n\n::: {.cell hash='histrico-de-taxas-de-juros-de-longo-prazo_cache/html/create-curves_a9fbbdece8ec435c6c6cf45cae291a17'}\n\n```{.r .cell-code}\nunique(dc$refdate) |> map(function(date, df) {\n    df_curve <- df |>\n        filter(refdate == date, biz_days > 0) |>\n        filter(!duplicated(biz_days))\n    curve <- spotratecurve(\n        df_curve$r_252,\n        df_curve$biz_days,\n        \"discrete\", \"business/252\", \"Brazil/ANBIMA\",\n        refdate = date\n    )\n    interpolation(curve) <- interp_flatforward()\n    curve\n}, df = dc) -> curves\n```\n:::\n\n\nObtendo um lista com as curvas de juros utilizamos os colchetes `[[`\npara realizar a interpolação no prazo fixo de 10 anos.\nComo estas curvas utilizam a regra de contagem de dias `business/252`,\ndevemos considerar que 1 ano tem 252 dias úteis e portanto,\n10 anos tem 2520 dias úteis.\nPor isso, interpolamos a curva no vértice 2520.\n\n\n::: {.cell hash='histrico-de-taxas-de-juros-de-longo-prazo_cache/html/create-historical-rates-brl_b5e4dcdaee35b340ddd12df106edf510'}\n\n```{.r .cell-code}\ncurves |>\n    map_dfr(\\(x) tibble(\n        refdate = x@refdate,\n        r_BRL_10y = as.numeric(x[[2520]])\n    )) -> rates_10y\n```\n:::\n\n\nJá aproveito e retorno o histórico em um data.frame com as colunas `refdate` e `r_BRL_10y`.\nFaço isso para juntar com os dados de juros americanos de 10 anos e assim comparar a dinâmica\ndas taxas conjuntamente.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates_10y <- rates_10y |>\n    left_join(yc_all |> select(Date, `10 YR`), by = c(\"refdate\" = \"Date\")) |>\n    rename(r_USD_us_10y = `10 YR`) |>\n    mutate(r_USD_us_10y = r_USD_us_10y / 100)\n```\n:::\n\n\nNote que eu nomeio a taxa de juros americana com `r_USD_us_10y`, pois essa é \numa taxa que capitaliza o dólar (USD) nos Estados Unidos (us).\nAbaixo faço um malabarismo com `tidyr::pivot_longer` para preparar os\ndados para o `ggplot` e assim visualizá-los lado a lado.\nNote ainda que libero a escala dos gráficos (`scales = \"free_y\"`)\npara que a diferença de nível entre as taxas de juros,\nbrasileira e americana, não afete a análise.\nO objetivo é visualizar a dinâmica das taxas de juros ao longo do tempo.\n\n\n::: {.cell preview='true'}\n\n```{.r .cell-code}\nrates_10y |>\n    tidyr::pivot_longer(\n        c(r_BRL_10y, r_USD_us_10y),\n        names_to = \"rates\"\n    ) |>\n    ggplot(aes(x = refdate, y = value, colour = rates)) +\n    geom_line() +\n    facet_wrap(. ~ rates, scales = \"free_y\") +\n    labs(\n        x = NULL, y = NULL,\n        title = \"Histórico de Taxas de Juros de 10 Anos\",\n        subtitle = \"Americanos (r_USD_us_10y) e Brasileiro (r_BRL_10y)\",\n        caption = \"wilsonfreitas\"\n    ) +\n    scale_y_continuous(labels = scales::percent) +\n    theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](histrico-de-taxas-de-juros-de-longo-prazo_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}